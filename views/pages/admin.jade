extend ../layout

block content
  .container
    .row
      form.form-horizontal(method="post", action="/admin/movie/new")
        //- input(type="hidden", name="movie[_id]", value="#{movie._id}")
        input(type="hidden", name="movie[_id]", value="#{movie._id}")
        //- 隐藏表单域，用来更新电影数据，存储电影ID
        .form-group
          label.col-sm-2.control-label 豆瓣同步
          .col-sm-10
            input#douban.form-control(type="text")
        if movie._id
          input(type="hidden", name="_id", value=movie._id)
        .form-group
          label.col-sm-2.control-label(for="inputTitle") 电影名称
          .col-sm-10
            input#inputTitle.form-control(type="text", name="movie[title]", value="#{movie.title}")
        .form-group
          label.col-sm-2.control-label(for="inputDirector") 电影导演
          .col-sm-10
            input#inputDirector.form-control(type="text", name="movie[director]", value="#{movie.director}")
        .form-group
          label.col-sm-2.control-label(for="inputCountry") 国家
          .col-sm-10
            input#inputCountry.form-control(type="text", name="movie[country]", value="#{movie.country}")
        .form-group
          label.col-sm-2.control-label(for="inputLanguage") 语种
          .col-sm-10
            input#inputLanguage.form-control(type="text", name="movie[language]", value="#{movie.language}")
        .form-group
          label.col-sm-2.control-label(for="inputPoster") 海报地址
          .col-sm-10
            input#inputPoster.form-control(type="text", name="movie[poster]", value="#{movie.poster}")
        .form-group
          label.col-sm-2.control-label(for="inputFlash") 片源地址
          .col-sm-10
            input#inputFlash.form-control(type="text", name="movie[flash]", value="#{movie.flash}")
        .form-group
          label.col-sm-2.control-label(for="inputYear") 上映年代
          .col-sm-10
            input#inputYear.form-control(type="text", name="movie[year]", value="#{movie.year}")
        .form-group
          label.col-sm-2.control-label(for="inputSummary") 电影简介
          .col-sm-10
            //- input#inputSummary.form-control(type="text", name="movie[summary]", value="#{movie.summary}")
            textarea#inputSummary.form-control(type="text", name="movie[summary]", value="#{movie.summary}")
        .form-group
          .col-sm-offset-2.col-sm-10
            button.btn.btn-default(type="submit") 录入
  script.
    $(function() {
      $('#douban').blur(function() {
        var douban = $(this)
        var id = douban.val()

        if (id) {
          $.ajax({
            url: 'https://api.douban.com/v2/movie/subject/' + id,
            cache: true,
            type: 'get',
            dataType: 'jsonp',
            crossDomain: true,
            jsonp: 'callback',
            success: function(data) {
              $('#inputTitle').val(data.title)
              $('#inputDirector').val(data.directors[0].name)
              $('#inputCountry').val(data.countries[0])
              $('#inputPoster').val(data.images.large)
              $('#inputYear').val(data.year)
              $('#inputSummary').val(data.summary)
            }
          })
        }
      })
    })